<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign Up</title>

<!-- Supabase JS (same style as your working file) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0fff0;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }
  .signup-box {
    background: #000;
    color: #fff;
    padding: 20px;
    border-radius: 12px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    box-sizing: border-box;
  }
  input {
    width: 90%;
    padding: 10px;
    margin: 8px 0;
    border-radius: 8px;
    border: none;
    box-sizing: border-box;
  }
  button {
    padding: 10px;
    width: 95%;
    background: lightgreen;
    border: none;
    color: black;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
  }
  button:hover { opacity: 0.8; }
  #message { margin-top: 12px; font-size: 14px; color: yellow; }
</style>
</head>
<body>

<div class="signup-box">
  <h2>Sign Up</h2>
  <form id="signup-form">
    <input type="text" id="username" placeholder="Username" required><br>
    <input type="email" id="email" placeholder="Email" required><br>
    <input type="password" id="password" placeholder="Password" required><br>
    <button type="submit">Sign Up</button>
  </form>
  <p id="message"></p>
</div>

<script>
  let supabase; // will hold the client (same pattern as your fixtures page)

  window.addEventListener('load', () => {
    const SUPABASE_URL = 'https://ccmsjcnuyrngqxwrswfe.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNjbXNqY251eXJuZ3F4d3Jzd2ZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2MjU2MjgsImV4cCI6MjA2NzIwMTYyOH0.dkjCo2bgDMf923VKESkyMLsULo7IhmsYb6r-4Dn6SRY';

    // EXACT same initialization style:
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const form = document.getElementById('signup-form');
    const message = document.getElementById('message');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const username = document.getElementById('username').value.trim();
      const email    = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      if (!username || !email || !password) {
        alert('❗ Please fill in all fields.');
        return;
      }

      message.style.color = 'yellow';
      message.textContent = 'Processing...';

      // 1) Sign up with Auth
      const { data: signUpData, error: signUpError } = await supabase.auth.signUp({ email, password });

      if (signUpError) {
        console.error('Auth error:', signUpError);
        message.textContent = signUpError.message || 'Sign up failed.';
        return;
      }

      // signUpData.user should contain the UUID even if email verification is pending
      const userId = signUpData?.user?.id;

      // 2) Insert profile row using SAME INSERT PATTERN as your working file
      //    (no password saved in profiles)
      const { error: insertError } = await supabase
        .from('profiles')
        .insert([{ id: userId, username, email }]); // <— same .from(...).insert([...]) style

      if (insertError) {
        console.error('Profile insert error:', insertError);
        message.textContent = 'Profile insert error: ' + insertError.message;
        return;
      }

      message.style.color = 'lightgreen';
      message.textContent = 'Almost there! Check your email for verification link.';
      form.reset();
    });
  });
</script>

</body>
</html>
